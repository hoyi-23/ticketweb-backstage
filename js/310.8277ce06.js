"use strict";(self["webpackChunkticketweb_backstage"]=self["webpackChunkticketweb_backstage"]||[]).push([[310],{8654:function(e,t,a){a.d(t,{Z:function(){return u}});var n=a(6252);(0,n.dD)("data-v-e77f9db0");const o={class:"loading"},l=(0,n._)("span",null,null,-1),d=[l];function r(e,t,a,l,r,i){return(0,n.wg)(),(0,n.iD)("div",o,d)}(0,n.Cn)();var i={name:"OnLoad"};i.render=r,i.__scopeId="data-v-e77f9db0";var u=i},4310:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ge}});var n=a(6252),o=a(9963);(0,n.dD)("data-v-0566e62c");const l={class:"products"},d={class:"addProduct__wrap"},r={key:0},i={key:1},u={class:"table-container"},c={key:0},s=(0,n._)("th",null,"活動名稱",-1),v=(0,n.Uk)(" 分類 "),p={class:"sortProducts"},_=(0,n._)("label",{for:"sortByType"},[(0,n._)("span",{class:"material-icons-outlined"},"keyboard_arrow_down")],-1),m=(0,n.Uk)("開始日期 "),g={class:"sortProducts"},f=(0,n._)("label",{for:"sortByStartDate"},[(0,n._)("span",{class:"material-icons-outlined"},"keyboard_arrow_down")],-1),y=(0,n.Uk)("結束日期 "),D={class:"sortProducts"},b=(0,n._)("label",{for:"sortByEndDate"},[(0,n._)("span",{class:"material-icons-outlined"},"keyboard_arrow_down")],-1),w=(0,n.Uk)("狀態 "),h={class:"sortProducts"},P=(0,n._)("label",{for:"sortByStatus"},[(0,n._)("span",{class:"material-icons-outlined"},"keyboard_arrow_down")],-1),k=(0,n._)("th",null,"操作",-1),C={key:0},E={key:1},I=(0,n._)("p",{class:"text-center"},"尚未建立任何活動",-1),S=[I],M={key:1};function U(e,t,a,I,U,T){const B=(0,n.up)("ExitCheck"),F=(0,n.up)("ProductModal"),L=(0,n.up)("ProductTable"),x=(0,n.up)("OnLoad");return(0,n.wg)(),(0,n.iD)("div",l,[(0,n._)("div",d,[(0,n._)("button",{class:"btn btn-primary fw-bold addProductBtn",id:"show-modal",onClick:t[0]||(t[0]=(...e)=>I.showingModal&&I.showingModal(...e))}," + 建立新活動 "),I.showExitCheckModal?((0,n.wg)(),(0,n.iD)("div",r,[(0,n.Wm)(B)])):(0,n.kq)("",!0),I.showModal?((0,n.wg)(),(0,n.iD)("div",i,[(0,n.Wm)(F)])):(0,n.kq)("",!0)]),(0,n._)("div",u,[I.checkProductLoaded?((0,n.wg)(),(0,n.iD)("table",c,[(0,n._)("thead",null,[(0,n._)("tr",null,[s,(0,n._)("th",null,[v,(0,n._)("div",p,[(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>I.sortProducts=e),value:"sortByType",type:"radio",id:"sortByType",name:"sortProducts"},null,512),[[o.G2,I.sortProducts]]),_])]),(0,n._)("th",null,[m,(0,n._)("div",g,[(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>I.sortProducts=e),type:"radio",value:"sortByStartDate",id:"sortByStartDate",name:"sortProducts"},null,512),[[o.G2,I.sortProducts]]),f])]),(0,n._)("th",null,[y,(0,n._)("div",D,[(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>I.sortProducts=e),type:"radio",value:"sortByEndDate",id:"sortByEndDate",name:"sortProducts"},null,512),[[o.G2,I.sortProducts]]),b])]),(0,n._)("th",null,[w,(0,n._)("div",h,[(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>I.sortProducts=e),type:"radio",value:"sortByStatus",id:"sortByStatus",name:"sortProducts"},null,512),[[o.G2,I.sortProducts]]),P])]),k])]),I.productData.length>0?((0,n.wg)(),(0,n.iD)("tbody",C,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(I.productData,((e,t)=>((0,n.wg)(),(0,n.j4)(L,{key:t,product:e},null,8,["product"])))),128))])):((0,n.wg)(),(0,n.iD)("tbody",E,S))])):((0,n.wg)(),(0,n.iD)("div",M,[(0,n.Wm)(x)]))])])}(0,n.Cn)(),(0,n.dD)("data-v-300f63d6");const T={class:"modal-mask"},B={class:"modal-wrapper"},F={class:"modal-container"},L={class:"grid formInput"},x=(0,n._)("label",{for:"eventTitle"},"活動名稱",-1),H={class:"grid"},q={class:"formInput grid__item--md-span-4"},A=(0,n._)("label",{for:"eventType"},"類型",-1),V=(0,n._)("option",{value:"",selected:"",disabled:""},"請選擇",-1),Z=(0,n._)("option",{value:"temp"},"短期",-1),j=(0,n._)("option",{value:"regular"},"常設",-1),z=[V,Z,j],R={class:"formInput grid__item--md-span-4"},O=(0,n._)("label",{for:"eventCategory"},"分類",-1),G=(0,n.uE)('<option value="" selected disabled data-v-300f63d6>請選擇</option><option value="music" data-v-300f63d6>音樂</option><option value="drama" data-v-300f63d6>戲劇</option><option value="dance" data-v-300f63d6>舞蹈</option><option value="design" data-v-300f63d6>設計</option><option value="art" data-v-300f63d6>藝術</option><option value="food" data-v-300f63d6>美食</option><option value="travel" data-v-300f63d6>旅遊</option><option value="family" data-v-300f63d6>親子</option><option value="movie" data-v-300f63d6>電影</option>',10),W=[G],Y={class:"formInput grid__item--md-span-4"},K=(0,n._)("label",{for:"eventLocation"},"場地",-1),N=(0,n._)("option",{value:"",selected:"",disabled:""},"請選擇",-1),$=(0,n._)("option",{value:"Aroom"},"圓形劇場",-1),J=(0,n._)("option",{value:"Broom"},"室外舞台",-1),Q=[N,$,J],X={class:"grid"},ee={class:"formInput grid__item--md-span-4"},te=(0,n._)("label",{for:"eventPriceFull"},"一般售價",-1),ae={class:"formInput grid__item--md-span-4"},ne=(0,n._)("label",{for:"eventPriceStudent"},"學生售價",-1),oe={class:"formInput grid__item--md-span-4"},le=(0,n._)("label",{for:"eventPriceDiscount"},"優惠售價",-1),de={class:"grid"},re={class:"formInput grid__item--md-span-6"},ie=(0,n._)("label",{for:"eventDateStart"},"開始日期",-1),ue={class:"formInput grid__item--md-span-6"},ce=(0,n._)("label",{for:"eventDateEnd"},"結束日期",-1),se={class:"grid formInput"},ve=(0,n._)("label",{for:"eventDescription"},"活動內容",-1),pe={class:"grid"},_e={class:"formInput grid__item--md-span-6"},me=(0,n._)("label",{for:"eventPhotos"},[(0,n.Uk)("活動照片"),(0,n._)("span",{style:{color:"red","font-size":"10px"}},"請勿上傳超過1MB")],-1),ge={class:"foremInput grid__item--md-span-6"},fe=["src"],ye={class:"grid justify-content-between"},De={class:"grid__item--md-span-6"},be={key:0,type:"submit",class:"btn fw-bold btn-danger"},we={class:"grid grid__item--md-span-6 justify-content-md-end"};function he(e,t,a,l,d,r){const i=(0,n.up)("OnLoad");return(0,n.wg)(),(0,n.iD)("div",{onClick:t[17]||(t[17]=(...e)=>l.checkClick&&l.checkClick(...e)),ref:"productModal",class:"productModal"},[(0,n._)("div",T,[(0,n._)("div",B,[(0,n._)("div",F,[(0,n._)("form",{onSubmit:t[16]||(t[16]=(0,o.iM)(((...e)=>l.submitForm&&l.submitForm(...e)),["prevent"])),class:"productForm"},[(0,n.wy)((0,n.Wm)(i,null,null,512),[[o.F8,l.loading]]),(0,n._)("div",L,[x,(0,n.wy)((0,n._)("input",{type:"text",id:"eventTitle","onUpdate:modelValue":t[0]||(t[0]=e=>l.eventTitle=e),required:""},null,512),[[o.nr,l.eventTitle]])]),(0,n._)("div",H,[(0,n._)("div",q,[A,(0,n.wy)((0,n._)("select",{name:"eventType",id:"eventType","onUpdate:modelValue":t[1]||(t[1]=e=>l.eventType=e),required:""},z,512),[[o.bM,l.eventType]])]),(0,n._)("div",R,[O,(0,n.wy)((0,n._)("select",{name:"eventCategory",id:"eventCategory","onUpdate:modelValue":t[2]||(t[2]=e=>l.eventCategory=e),required:""},W,512),[[o.bM,l.eventCategory]])]),(0,n._)("div",Y,[K,(0,n.wy)((0,n._)("select",{name:"eventLocation",id:"eventLocation","onUpdate:modelValue":t[3]||(t[3]=e=>l.eventLocation=e),required:""},Q,512),[[o.bM,l.eventLocation]])])]),(0,n._)("div",X,[(0,n._)("div",ee,[te,(0,n.wy)((0,n._)("input",{type:"number",id:"eventPriceFull","onUpdate:modelValue":t[4]||(t[4]=e=>l.eventFullPrice=e),required:""},null,512),[[o.nr,l.eventFullPrice]])]),(0,n._)("div",ae,[ne,(0,n.wy)((0,n._)("input",{type:"number",id:"eventPriceStudent","onUpdate:modelValue":t[5]||(t[5]=e=>l.eventStudentPrice=e),required:""},null,512),[[o.nr,l.eventStudentPrice]])]),(0,n._)("div",oe,[le,(0,n.wy)((0,n._)("input",{type:"number",id:"eventPriceDiscount","onUpdate:modelValue":t[6]||(t[6]=e=>l.eventDiscountPrice=e),required:""},null,512),[[o.nr,l.eventDiscountPrice]])])]),(0,n._)("div",de,[(0,n._)("div",re,[ie,(0,n.wy)((0,n._)("input",{type:"date",id:"eventDateStart",onChange:t[7]||(t[7]=e=>l.checkEndDate(l.eventEndDate,l.eventStartDate)),"onUpdate:modelValue":t[8]||(t[8]=e=>l.eventStartDate=e),required:""},null,544),[[o.nr,l.eventStartDate]])]),(0,n._)("div",ue,[ce,(0,n.wy)((0,n._)("input",{type:"date",id:"eventDateEnd",onChange:t[9]||(t[9]=e=>l.checkEndDate(l.eventEndDate,l.eventStartDate)),"onUpdate:modelValue":t[10]||(t[10]=e=>l.eventEndDate=e),required:""},null,544),[[o.nr,l.eventEndDate]])])]),(0,n._)("div",se,[ve,(0,n.wy)((0,n._)("textarea",{name:"eventDescription",id:"eventDescription","onUpdate:modelValue":t[11]||(t[11]=e=>l.eventDescription=e),cols:"30",rows:"5",required:""},null,512),[[o.nr,l.eventDescription]])]),(0,n._)("div",pe,[(0,n._)("div",_e,[me,(0,n._)("input",{type:"file",id:"eventPhotos",accept:"image/gif,image/jpeg,image/jpg,image/png",onChange:t[12]||(t[12]=(...e)=>l.uploadPhoto&&l.uploadPhoto(...e)),multiple:"multiple"},null,32)]),(0,n._)("div",ge,[(0,n._)("img",{src:l.eventPhotos,class:"preview"},null,8,fe)])]),(0,n._)("div",ye,[(0,n._)("div",De,[(0,n._)("button",{type:"button",class:"btn fw-bold btn-cancel",onClick:t[13]||(t[13]=(...e)=>l.closingModal&&l.closingModal(...e))},"取消編輯"),l.productEdit?((0,n.wg)(),(0,n.iD)("button",be,"儲存修改")):(0,n.kq)("",!0)]),(0,n._)("div",we,[(0,n._)("button",{type:"submit",class:"btn fw-bold btn-cancel",onClick:t[14]||(t[14]=(...e)=>l.saveDraft&&l.saveDraft(...e))},"設為草稿"),(0,n._)("button",{type:"submit",class:"btn fw-bold btn-danger",onClick:t[15]||(t[15]=(...e)=>l.publishEvent&&l.publishEvent(...e))},"建立活動")])])],32)])])])],512)}(0,n.Cn)();var Pe=a(4709),ke=a(2262),Ce=a(5503),Ee=(a(9433),a(144),a(8654)),Ie={name:"ProductModal",components:{OnLoad:Ee.Z},setup(){const e=(0,ke.iH)(null),t=(0,ke.iH)(null),a=(0,ke.iH)(null),o=(0,ke.iH)(null),l=(0,ke.iH)(null),d=(0,ke.iH)(null),r=(0,ke.iH)(null),i=(0,ke.iH)(null),u=(0,ke.iH)(null),c=(0,ke.iH)(null),s=(0,ke.iH)(null),v=(0,ke.iH)(null),p=(0,ke.iH)(null),_=(0,ke.iH)(null),m=(0,ke.iH)(null),g=(0,ke.iH)(null),f=Ce.Z.firestore();function y(){m.value=!0,g.value=!1}function D(){g.value=!0,m.value=!1}function b(){S.value?U():P()}function w(e,t){let a=Date.now();if(Date.parse(e)<=Date.parse(t))alert("結束日期不得在開始日期前"),v.value=null,s.value=null;else{if(!(Date.parse(e)<=a||Date.parse(t)<a))return;alert("日期設置有誤"),v.value=null,s.value=null}}function h(e){const t=e.target.files.length,a=e.target.files,n=new Image;for(var o=0;o<t;o++){const e=new FileReader;e.readAsDataURL(a[o]),e.onload=function(){n.src=e.result},n.onload=function(){const e=Math.min(1800,n.width),t=n.height*(e/n.width),a=document.createElement("canvas"),o=a.getContext("2d");if(a.width=e,a.height=t,o.drawImage(n,0,0,e,t),a.toDataURL("image/jpeg").length>=1016907)return alert("圖檔過大，請勿上船超過1MB"),void(document.getElementById("eventPhotos").value=null);_.value=a.toDataURL("image/jpeg")}}}async function P(){if(_.value){e.value=!0;const t=f.collection("products").doc();await t.set({eventId:a.value,eventTitle:o.value,eventType:l.value,eventCategory:d.value,eventLocation:r.value,eventFullPrice:i.value,eventStudentPrice:u.value,eventDiscountPrice:c.value,eventStartDate:s.value,eventEndDate:v.value,eventDescription:p.value,eventActive:m.value,eventDraft:g.value});const n=await Ce.Z.storage().ref("Images/"+a.value+".jpeg");await n.putString(_.value,"data_url").then((e=>{console.log("Uploaded a data_url string!")})),e.value=!1,C(),k.dispatch("getProduct")}else alert("沒有上傳照片喔!")}const k=(0,Pe.oR)();function C(){k.dispatch("closingModal",!1)}function E(e){"modal-wrapper"===e.target.className&&I()}function I(){k.dispatch("showExitCheck",!0)}const S=(0,ke.Fl)((()=>k.getters.editProduct)),M=(0,ke.Fl)((()=>k.getters.currentProductArray));async function U(){e.value=!0;const n=t.value;await f.collection("products").doc(n).update({eventTitle:o.value,eventType:l.value,eventCategory:d.value,eventLocation:r.value,eventFullPrice:i.value,eventStudentPrice:u.value,eventDiscountPrice:c.value,eventStartDate:s.value,eventEndDate:v.value,eventDescription:p.value,eventActive:m.value,eventDraft:g.value}),console.log(_.value);const y=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;y.test(_.value)&&Ce.Z.storage().ref("Images/"+a.value+".jpeg").putString(_.value,"data_url").then((e=>{console.log("Uploaded a data_url string!")}));const D={docId:t.value,eventId:a.value};await k.dispatch("updateProduct",D),e.value=!1,C()}return(0,n.wF)((()=>{if(!S.value){let e=Math.floor(Date.now()/1e3);a.value=e}S.value&&(console.log(M.value.photoUrl),t.value=M.value.docId,a.value=M.value.data.eventId,o.value=M.value.data.eventTitle,l.value=M.value.data.eventType,d.value=M.value.data.eventCategory,r.value=M.value.data.eventLocation,i.value=M.value.data.eventFullPrice,u.value=M.value.data.eventStudentPrice,c.value=M.value.data.eventDiscountPrice,s.value=M.value.data.eventStartDate,v.value=M.value.data.eventEndDate,p.value=M.value.data.eventDescription,_.value=M.value.photoUrl,m.value=M.value.data.eventActive,g.value=M.value.data.eventDraft)})),{loading:e,docId:t,eventId:a,eventTitle:o,eventType:l,eventCategory:d,eventLocation:r,eventFullPrice:i,eventStudentPrice:u,eventDiscountPrice:c,eventStartDate:s,eventEndDate:v,eventDescription:p,eventActive:m,eventDraft:g,eventPhotos:_,uploadPhoto:h,saveDraft:D,publishEvent:y,submitForm:b,closingModal:C,checkClick:E,showingExitCheck:I,eventUpload:P,productEdit:S,eventUpdate:U,checkEndDate:w}}};Ie.render=he,Ie.__scopeId="data-v-300f63d6";var Se=Ie;(0,n.dD)("data-v-451689d0");const Me={class:"modal-mask"},Ue={class:"modal-wrapper"},Te={class:"modal-container"},Be=(0,n._)("p",null,"確定要退出嗎? 您的變更不會儲存喔!",-1),Fe={class:"text-center btn-group"};function Le(e,t,a,o,l,d){return(0,n.wg)(),(0,n.iD)("div",Me,[(0,n._)("div",Ue,[(0,n._)("div",Te,[Be,(0,n._)("div",Fe,[(0,n._)("button",{type:"button",class:"btn fw-bold btn-danger",onClick:t[0]||(t[0]=(...e)=>o.closeExitCheck&&o.closeExitCheck(...e))},"繼續編輯"),(0,n._)("button",{type:"button",class:"btn fw-bold btn-cancel",onClick:t[1]||(t[1]=(...e)=>o.closingBothModal&&o.closingBothModal(...e))},"放棄編輯")])])])])}(0,n.Cn)();var xe={name:"ExitCheck",setup(){const e=(0,Pe.oR)();function t(){e.dispatch("closingModal",!1),a()}function a(){e.dispatch("closeExitCheck",!1)}return{closingBothModal:t,closeExitCheck:a}}};xe.render=Le,xe.__scopeId="data-v-451689d0";var He=xe,qe=a(3577);const Ae={class:"productTable"},Ve={key:0},Ze={key:1};function je(e,t,a,o,l,d){return(0,n.wg)(),(0,n.iD)("tr",Ae,[(0,n._)("td",null,(0,qe.zw)(a.product.eventTitle),1),(0,n._)("td",null,(0,qe.zw)(a.product.eventCategory),1),(0,n._)("td",null,(0,qe.zw)(a.product.eventStartDate),1),(0,n._)("td",null,(0,qe.zw)(a.product.eventEndDate),1),(0,n._)("td",null,[a.product.eventActive?((0,n.wg)(),(0,n.iD)("p",Ve,"已啟用")):(0,n.kq)("",!0),a.product.eventDraft?((0,n.wg)(),(0,n.iD)("p",Ze,"尚未啟用")):(0,n.kq)("",!0)]),(0,n._)("td",null,[(0,n._)("button",{class:"btn-danger fw-bold",type:"button",onClick:t[0]||(t[0]=e=>o.deleteEvent(a.product.docId,a.product.eventId))},"刪除"),(0,n._)("button",{class:"btn-cancel fw-bold",type:"button",onClick:t[1]||(t[1]=e=>o.editEvent(a.product.eventId))},"編輯")])])}var ze={name:"ProductTable",props:["product"],setup(){const e=(0,Pe.oR)();function t(t){e.dispatch("editProduct",!0),e.dispatch("getCurrentProduct",t)}async function a(t,a){const n=await confirm("確定要刪除嗎? 一去不復返喔!");n&&(e.dispatch("deleteProduct",{docId:t,eventId:a}),e.dispatch("getProduct"))}return{editEvent:t,deleteEvent:a}}};ze.render=je;var Re=ze,Oe={name:"products",components:{ProductModal:Se,ExitCheck:He,ProductTable:Re,OnLoad:Ee.Z},setup(){const e=(0,Pe.oR)(),t=(0,ke.Fl)((()=>e.getters.showExitCheckModal)),a=(0,ke.Fl)((()=>e.getters.showModal));function o(){e.dispatch("showingModal",!0),e.dispatch("editProduct",!1)}(0,n.wF)((()=>{e.dispatch("getProduct")}));const l=(0,ke.Fl)((()=>e.getters.productLoaded)),d=(0,ke.iH)(null);(0,n.YP)(d,(()=>{switch(d.value){case"sortByType":r.value.sort(((e,t)=>e.eventCategory>t.eventCategory?1:-1));break;case"sortByStartDate":r.value.sort(((e,t)=>e.eventStartDate>t.eventStartDate?1:-1));break;case"sortByEndDate":r.value.sort(((e,t)=>e.eventEndDate>t.eventEndDate?1:-1));break;case"sortByStatus":r.value.sort(((e,t)=>e.eventActive>t.eventActive?1:-1))}}));const r=(0,ke.Fl)((()=>{const t=e.getters.productData;let a=Date.now();const n=t.map((e=>(Date.parse(e.eventEndDate)<=a&&(e.eventActive=!1,e.eventDraft=!0,Ce.Z.firestore().collection("products").doc(e.docId).update({eventActive:!1,eventDraft:!0})),e)));return n}));return{showExitCheckModal:t,showModal:a,showingModal:o,checkProductLoaded:l,productData:r,sortProducts:d}}};Oe.render=U,Oe.__scopeId="data-v-0566e62c";var Ge=Oe}}]);
//# sourceMappingURL=310.8277ce06.js.map