"use strict";(self["webpackChunkticketweb_backstage"]=self["webpackChunkticketweb_backstage"]||[]).push([[669],{8654:function(e,t,a){a.d(t,{Z:function(){return c}});var n=a(6252);(0,n.dD)("data-v-e77f9db0");const l={class:"loading"},o=(0,n._)("span",null,null,-1),d=[o];function i(e,t,a,o,i,u){return(0,n.wg)(),(0,n.iD)("div",l,d)}(0,n.Cn)();var u={name:"OnLoad"};u.render=i,u.__scopeId="data-v-e77f9db0";var c=u},6669:function(e,t,a){a.r(t),a.d(t,{default:function(){return Le}});var n=a(6252);const l={class:"products"},o={class:"addProduct__wrap"},d={key:0},i={key:1},u={class:"table-container"},c={key:0},r=(0,n._)("thead",null,[(0,n._)("tr",null,[(0,n._)("th",null,"活動名稱"),(0,n._)("th",null,"分類"),(0,n._)("th",null,"開始日期"),(0,n._)("th",null,"結束日期"),(0,n._)("th",null,"狀態"),(0,n._)("th",null,"操作")])],-1),v={key:0},s={key:1},p=(0,n._)("p",{class:"text-center"},"尚未建立任何活動",-1),g=[p],_={key:1};function m(e,t,a,p,m,b){const f=(0,n.up)("ExitCheck"),h=(0,n.up)("ProductModal"),D=(0,n.up)("ProductTable"),w=(0,n.up)("OnLoad");return(0,n.wg)(),(0,n.iD)("div",l,[(0,n._)("div",o,[(0,n._)("button",{class:"btn btn-primary fw-bold addProductBtn",id:"show-modal",onClick:t[0]||(t[0]=(...e)=>p.showingModal&&p.showingModal(...e))}," + 建立新活動 "),p.showExitCheckModal?((0,n.wg)(),(0,n.iD)("div",d,[(0,n.Wm)(f)])):(0,n.kq)("",!0),p.showModal?((0,n.wg)(),(0,n.iD)("div",i,[(0,n.Wm)(h)])):(0,n.kq)("",!0)]),(0,n._)("div",u,[p.checkProductLoaded?((0,n.wg)(),(0,n.iD)("table",c,[r,p.productData.length>0?((0,n.wg)(),(0,n.iD)("tbody",v,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(p.productData,((e,t)=>((0,n.wg)(),(0,n.j4)(D,{key:t,product:e},null,8,["product"])))),128))])):((0,n.wg)(),(0,n.iD)("tbody",s,g))])):((0,n.wg)(),(0,n.iD)("div",_,[(0,n.Wm)(w)]))])])}var b=a(9963);(0,n.dD)("data-v-6fb2abe2");const f={class:"modal-mask"},h={class:"modal-wrapper"},D={class:"modal-container"},w={class:"grid formInput"},y=(0,n._)("label",{for:"eventTitle"},"活動名稱",-1),k={class:"grid"},P={class:"formInput grid__item--md-span-4"},C=(0,n._)("label",{for:"eventType"},"類型",-1),E=(0,n._)("option",{value:"",selected:"",disabled:""},"請選擇",-1),I=(0,n._)("option",{value:"temp"},"短期",-1),M=(0,n._)("option",{value:"regular"},"常設",-1),F=[E,I,M],S={class:"formInput grid__item--md-span-4"},T=(0,n._)("label",{for:"eventCategory"},"分類",-1),L=(0,n.uE)('<option value="" selected disabled data-v-6fb2abe2>請選擇</option><option value="music" data-v-6fb2abe2>音樂</option><option value="drama" data-v-6fb2abe2>戲劇</option><option value="dance" data-v-6fb2abe2>舞蹈</option><option value="design" data-v-6fb2abe2>設計</option><option value="art" data-v-6fb2abe2>藝術</option><option value="food" data-v-6fb2abe2>美食</option><option value="travel" data-v-6fb2abe2>旅遊</option><option value="family" data-v-6fb2abe2>親子</option><option value="movie" data-v-6fb2abe2>電影</option>',10),U=[L],x={class:"formInput grid__item--md-span-4"},H=(0,n._)("label",{for:"eventLocation"},"場地",-1),q=(0,n._)("option",{value:"",selected:"",disabled:""},"請選擇",-1),V=(0,n._)("option",{value:"Aroom"},"圓形劇場",-1),j=(0,n._)("option",{value:"Broom"},"室外舞台",-1),A=[q,V,j],B={class:"grid"},R={class:"formInput grid__item--md-span-4"},Z=(0,n._)("label",{for:"eventPriceFull"},"一般售價",-1),z={class:"formInput grid__item--md-span-4"},O=(0,n._)("label",{for:"eventPriceStudent"},"學生售價",-1),W={class:"formInput grid__item--md-span-4"},K=(0,n._)("label",{for:"eventPriceDiscount"},"優惠售價",-1),N={class:"grid"},Y={class:"formInput grid__item--md-span-6"},G=(0,n._)("label",{for:"eventDateStart"},"開始日期",-1),J={class:"formInput grid__item--md-span-6"},Q=(0,n._)("label",{for:"eventDateEnd"},"結束日期",-1),X={class:"grid formInput"},$=(0,n._)("label",{for:"eventDescription"},"活動內容",-1),ee={class:"grid"},te={class:"formInput grid__item--md-span-6"},ae=(0,n._)("label",{for:"eventPhotos"},[(0,n.Uk)("活動照片"),(0,n._)("span",{style:{color:"red","font-size":"10px"}},"請勿上傳超過1MB")],-1),ne={class:"foremInput grid__item--md-span-6"},le=["src"],oe={class:"grid justify-content-between"},de={class:"grid__item--md-span-6"},ie={key:0,type:"submit",class:"btn fw-bold btn-danger"},ue={class:"grid grid__item--md-span-6 justify-content-md-end"};function ce(e,t,a,l,o,d){const i=(0,n.up)("OnLoad");return(0,n.wg)(),(0,n.iD)("div",{onClick:t[17]||(t[17]=(...e)=>l.checkClick&&l.checkClick(...e)),ref:"productModal",class:"productModal"},[(0,n._)("div",f,[(0,n._)("div",h,[(0,n._)("div",D,[(0,n._)("form",{onSubmit:t[16]||(t[16]=(0,b.iM)(((...e)=>l.submitForm&&l.submitForm(...e)),["prevent"])),class:"productForm"},[(0,n.wy)((0,n.Wm)(i,null,null,512),[[b.F8,l.loading]]),(0,n._)("div",w,[y,(0,n.wy)((0,n._)("input",{type:"text",id:"eventTitle","onUpdate:modelValue":t[0]||(t[0]=e=>l.eventTitle=e),required:""},null,512),[[b.nr,l.eventTitle]])]),(0,n._)("div",k,[(0,n._)("div",P,[C,(0,n.wy)((0,n._)("select",{name:"eventType",id:"eventType","onUpdate:modelValue":t[1]||(t[1]=e=>l.eventType=e),required:""},F,512),[[b.bM,l.eventType]])]),(0,n._)("div",S,[T,(0,n.wy)((0,n._)("select",{name:"eventCategory",id:"eventCategory","onUpdate:modelValue":t[2]||(t[2]=e=>l.eventCategory=e),required:""},U,512),[[b.bM,l.eventCategory]])]),(0,n._)("div",x,[H,(0,n.wy)((0,n._)("select",{name:"eventLocation",id:"eventLocation","onUpdate:modelValue":t[3]||(t[3]=e=>l.eventLocation=e),required:""},A,512),[[b.bM,l.eventLocation]])])]),(0,n._)("div",B,[(0,n._)("div",R,[Z,(0,n.wy)((0,n._)("input",{type:"number",id:"eventPriceFull","onUpdate:modelValue":t[4]||(t[4]=e=>l.eventFullPrice=e),required:""},null,512),[[b.nr,l.eventFullPrice]])]),(0,n._)("div",z,[O,(0,n.wy)((0,n._)("input",{type:"number",id:"eventPriceStudent","onUpdate:modelValue":t[5]||(t[5]=e=>l.eventStudentPrice=e),required:""},null,512),[[b.nr,l.eventStudentPrice]])]),(0,n._)("div",W,[K,(0,n.wy)((0,n._)("input",{type:"number",id:"eventPriceDiscount","onUpdate:modelValue":t[6]||(t[6]=e=>l.eventDiscountPrice=e),required:""},null,512),[[b.nr,l.eventDiscountPrice]])])]),(0,n._)("div",N,[(0,n._)("div",Y,[G,(0,n.wy)((0,n._)("input",{type:"date",id:"eventDateStart",onChange:t[7]||(t[7]=e=>l.checkEndDate(l.eventEndDate,l.eventStartDate)),"onUpdate:modelValue":t[8]||(t[8]=e=>l.eventStartDate=e),required:""},null,544),[[b.nr,l.eventStartDate]])]),(0,n._)("div",J,[Q,(0,n.wy)((0,n._)("input",{type:"date",id:"eventDateEnd",onChange:t[9]||(t[9]=e=>l.checkEndDate(l.eventEndDate,l.eventStartDate)),"onUpdate:modelValue":t[10]||(t[10]=e=>l.eventEndDate=e),required:""},null,544),[[b.nr,l.eventEndDate]])])]),(0,n._)("div",X,[$,(0,n.wy)((0,n._)("textarea",{name:"eventDescription",id:"eventDescription","onUpdate:modelValue":t[11]||(t[11]=e=>l.eventDescription=e),cols:"30",rows:"5",required:""},null,512),[[b.nr,l.eventDescription]])]),(0,n._)("div",ee,[(0,n._)("div",te,[ae,(0,n._)("input",{type:"file",id:"eventPhotos",accept:"image/gif,image/jpeg,image/jpg,image/png",onChange:t[12]||(t[12]=(...e)=>l.uploadPhoto&&l.uploadPhoto(...e)),multiple:"multiple"},null,32)]),(0,n._)("div",ne,[(0,n._)("img",{src:l.eventPhotos,class:"preview"},null,8,le)])]),(0,n._)("div",oe,[(0,n._)("div",de,[(0,n._)("button",{type:"button",class:"btn fw-bold btn-cancel",onClick:t[13]||(t[13]=(...e)=>l.closingModal&&l.closingModal(...e))},"取消編輯"),l.productEdit?((0,n.wg)(),(0,n.iD)("button",ie,"儲存修改")):(0,n.kq)("",!0)]),(0,n._)("div",ue,[(0,n._)("button",{type:"submit",class:"btn fw-bold btn-cancel",onClick:t[14]||(t[14]=(...e)=>l.saveDraft&&l.saveDraft(...e))},"設為草稿"),(0,n._)("button",{type:"submit",class:"btn fw-bold btn-danger",onClick:t[15]||(t[15]=(...e)=>l.publishEvent&&l.publishEvent(...e))},"建立活動")])])],32)])])])],512)}(0,n.Cn)();var re=a(4709),ve=a(2262),se=a(5503),pe=(a(9433),a(144),a(8654)),ge={name:"ProductModal",components:{OnLoad:pe.Z},setup(){const e=(0,ve.iH)(null),t=(0,ve.iH)(null),a=(0,ve.iH)(null),l=(0,ve.iH)(null),o=(0,ve.iH)(null),d=(0,ve.iH)(null),i=(0,ve.iH)(null),u=(0,ve.iH)(null),c=(0,ve.iH)(null),r=(0,ve.iH)(null),v=(0,ve.iH)(null),s=(0,ve.iH)(null),p=(0,ve.iH)(null),g=(0,ve.iH)(null),_=(0,ve.iH)(null),m=(0,ve.iH)(null),b=se.Z.firestore();function f(){_.value=!0,m.value=!1}function h(){m.value=!0,_.value=!1}function D(){M.value?S():k()}function w(e,t){let a=Date.now();if(Date.parse(e)<=Date.parse(t))alert("結束日期不得在開始日期前"),s.value=null,v.value=null;else{if(!(Date.parse(e)<=a||Date.parse(t)<a))return;alert("日期設置有誤"),s.value=null,v.value=null}}function y(e){const t=e.target.files.length,a=e.target.files,n=new Image;for(var l=0;l<t;l++){const e=new FileReader;e.readAsDataURL(a[l]),e.onload=function(){n.src=e.result},n.onload=function(){const e=Math.min(1800,n.width),t=n.height*(e/n.width),a=document.createElement("canvas"),l=a.getContext("2d");if(a.width=e,a.height=t,l.drawImage(n,0,0,e,t),a.toDataURL("image/jpeg").length>=1016907)return alert("圖檔過大，請勿上船超過1MB"),void(document.getElementById("eventPhotos").value=null);g.value=a.toDataURL("image/jpeg")}}}async function k(){if(g.value){e.value=!0;const t=b.collection("products").doc();await t.set({eventId:a.value,eventTitle:l.value,eventType:o.value,eventCategory:d.value,eventLocation:i.value,eventFullPrice:u.value,eventStudentPrice:c.value,eventDiscountPrice:r.value,eventStartDate:v.value,eventEndDate:s.value,eventDescription:p.value,eventActive:_.value,eventDraft:m.value});const n=await se.Z.storage().ref("Images/"+a.value+".jpeg");await n.putString(g.value,"data_url").then((e=>{console.log("Uploaded a data_url string!")})),e.value=!1,C(),P.dispatch("getProduct")}else alert("沒有上傳照片喔!")}const P=(0,re.oR)();function C(){P.dispatch("closingModal",!1)}function E(e){"modal-wrapper"===e.target.className&&I()}function I(){P.dispatch("showExitCheck",!0)}const M=(0,ve.Fl)((()=>P.getters.editProduct)),F=(0,ve.Fl)((()=>P.getters.currentProductArray));async function S(){e.value=!0;const n=t.value;await b.collection("products").doc(n).update({eventTitle:l.value,eventType:o.value,eventCategory:d.value,eventLocation:i.value,eventFullPrice:u.value,eventStudentPrice:c.value,eventDiscountPrice:r.value,eventStartDate:v.value,eventEndDate:s.value,eventDescription:p.value,eventActive:_.value,eventDraft:m.value}),se.Z.storage().ref("Images/"+a.value+".jpeg").putString(g.value,"data_url").then((e=>{console.log("Uploaded a data_url string!")}));const f={docId:t.value,eventId:a.value};await P.dispatch("updateProduct",f),e.value=!1,C()}return(0,n.wF)((()=>{if(!M.value){let e=Math.floor(Date.now()/1e3);a.value=e}M.value&&(console.log(F.value.photoUrl),t.value=F.value.docId,a.value=F.value.data.eventId,l.value=F.value.data.eventTitle,o.value=F.value.data.eventType,d.value=F.value.data.eventCategory,i.value=F.value.data.eventLocation,u.value=F.value.data.eventFullPrice,c.value=F.value.data.eventStudentPrice,r.value=F.value.data.eventDiscountPrice,v.value=F.value.data.eventStartDate,s.value=F.value.data.eventEndDate,p.value=F.value.data.eventDescription,g.value=F.value.photoUrl,_.value=F.value.data.eventActive,m.value=F.value.data.eventDraft)})),{loading:e,docId:t,eventId:a,eventTitle:l,eventType:o,eventCategory:d,eventLocation:i,eventFullPrice:u,eventStudentPrice:c,eventDiscountPrice:r,eventStartDate:v,eventEndDate:s,eventDescription:p,eventActive:_,eventDraft:m,eventPhotos:g,uploadPhoto:y,saveDraft:h,publishEvent:f,submitForm:D,closingModal:C,checkClick:E,showingExitCheck:I,eventUpload:k,productEdit:M,eventUpdate:S,checkEndDate:w}}};ge.render=ce,ge.__scopeId="data-v-6fb2abe2";var _e=ge;(0,n.dD)("data-v-451689d0");const me={class:"modal-mask"},be={class:"modal-wrapper"},fe={class:"modal-container"},he=(0,n._)("p",null,"確定要退出嗎? 您的變更不會儲存喔!",-1),De={class:"text-center btn-group"};function we(e,t,a,l,o,d){return(0,n.wg)(),(0,n.iD)("div",me,[(0,n._)("div",be,[(0,n._)("div",fe,[he,(0,n._)("div",De,[(0,n._)("button",{type:"button",class:"btn fw-bold btn-danger",onClick:t[0]||(t[0]=(...e)=>l.closeExitCheck&&l.closeExitCheck(...e))},"繼續編輯"),(0,n._)("button",{type:"button",class:"btn fw-bold btn-cancel",onClick:t[1]||(t[1]=(...e)=>l.closingBothModal&&l.closingBothModal(...e))},"放棄編輯")])])])])}(0,n.Cn)();var ye={name:"ExitCheck",setup(){const e=(0,re.oR)();function t(){e.dispatch("closingModal",!1),a()}function a(){e.dispatch("closeExitCheck",!1)}return{closingBothModal:t,closeExitCheck:a}}};ye.render=we,ye.__scopeId="data-v-451689d0";var ke=ye,Pe=a(3577);const Ce={class:"productTable"},Ee={key:0},Ie={key:1};function Me(e,t,a,l,o,d){return(0,n.wg)(),(0,n.iD)("tr",Ce,[(0,n._)("td",null,(0,Pe.zw)(a.product.eventTitle),1),(0,n._)("td",null,(0,Pe.zw)(a.product.eventCategory),1),(0,n._)("td",null,(0,Pe.zw)(a.product.eventStartDate),1),(0,n._)("td",null,(0,Pe.zw)(a.product.eventEndDate),1),(0,n._)("td",null,[a.product.eventActive?((0,n.wg)(),(0,n.iD)("p",Ee,"已啟用")):(0,n.kq)("",!0),a.product.eventDraft?((0,n.wg)(),(0,n.iD)("p",Ie,"尚未啟用")):(0,n.kq)("",!0)]),(0,n._)("td",null,[(0,n._)("button",{class:"btn-danger fw-bold",type:"button",onClick:t[0]||(t[0]=e=>l.deleteEvent(a.product.docId,a.product.eventId))},"刪除"),(0,n._)("button",{class:"btn-cancel fw-bold",type:"button",onClick:t[1]||(t[1]=e=>l.editEvent(a.product.eventId))},"編輯")])])}var Fe={name:"ProductTable",props:["product"],setup(){const e=(0,re.oR)();function t(t){e.dispatch("editProduct",!0),e.dispatch("getCurrentProduct",t)}async function a(t,a){const n=await confirm("確定要刪除嗎? 一去不復返喔!");n&&(e.dispatch("deleteProduct",{docId:t,eventId:a}),e.dispatch("getProduct"))}return{editEvent:t,deleteEvent:a}}};Fe.render=Me;var Se=Fe,Te={name:"products",components:{ProductModal:_e,ExitCheck:ke,ProductTable:Se,OnLoad:pe.Z},setup(){const e=(0,re.oR)(),t=(0,ve.Fl)((()=>e.getters.showExitCheckModal)),a=(0,ve.Fl)((()=>e.getters.showModal));function l(){e.dispatch("showingModal",!0),e.dispatch("editProduct",!1)}(0,n.wF)((()=>{e.dispatch("getProduct")}));const o=(0,ve.Fl)((()=>e.getters.productLoaded)),d=(0,ve.Fl)((()=>e.getters.productData));return{showExitCheckModal:t,showModal:a,showingModal:l,checkProductLoaded:o,productData:d}}};Te.render=m;var Le=Te}}]);
//# sourceMappingURL=669.5049c6e9.js.map