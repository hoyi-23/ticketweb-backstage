"use strict";(self["webpackChunkticketweb_backstage"]=self["webpackChunkticketweb_backstage"]||[]).push([[763],{8654:function(e,t,n){n.d(t,{Z:function(){return c}});var a=n(6252);(0,a.dD)("data-v-e77f9db0");const l={class:"loading"},o=(0,a._)("span",null,null,-1),d=[o];function i(e,t,n,o,i,u){return(0,a.wg)(),(0,a.iD)("div",l,d)}(0,a.Cn)();var u={name:"OnLoad"};u.render=i,u.__scopeId="data-v-e77f9db0";var c=u},8763:function(e,t,n){n.r(t),n.d(t,{default:function(){return Se}});var a=n(6252);const l={class:"products"},o={class:"addProduct__wrap"},d={key:0},i={key:1},u={class:"table-container"},c={key:0},r=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"活動名稱"),(0,a._)("th",null,"分類"),(0,a._)("th",null,"開始日期"),(0,a._)("th",null,"結束日期"),(0,a._)("th",null,"狀態"),(0,a._)("th",null,"操作")])],-1),v={key:0},s={key:1},p=(0,a._)("p",{class:"text-center"},"尚未建立任何活動",-1),_=[p],g={key:1};function m(e,t,n,p,m,f){const b=(0,a.up)("ExitCheck"),h=(0,a.up)("ProductModal"),w=(0,a.up)("ProductTable"),D=(0,a.up)("OnLoad");return(0,a.wg)(),(0,a.iD)("div",l,[(0,a._)("div",o,[(0,a._)("button",{class:"btn btn-primary fw-bold addProductBtn",id:"show-modal",onClick:t[0]||(t[0]=(...e)=>p.showingModal&&p.showingModal(...e))}," + 建立新活動 "),p.showExitCheckModal?((0,a.wg)(),(0,a.iD)("div",d,[(0,a.Wm)(b)])):(0,a.kq)("",!0),p.showModal?((0,a.wg)(),(0,a.iD)("div",i,[(0,a.Wm)(h)])):(0,a.kq)("",!0)]),(0,a._)("div",u,[p.checkProductLoaded?((0,a.wg)(),(0,a.iD)("table",c,[r,p.productData.length>0?((0,a.wg)(),(0,a.iD)("tbody",v,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(p.productData,((e,t)=>((0,a.wg)(),(0,a.j4)(w,{key:t,product:e},null,8,["product"])))),128))])):((0,a.wg)(),(0,a.iD)("tbody",s,_))])):((0,a.wg)(),(0,a.iD)("div",g,[(0,a.Wm)(D)]))])])}var f=n(9963);(0,a.dD)("data-v-2f9dca76");const b={class:"modal-mask"},h={class:"modal-wrapper"},w={class:"modal-container"},D={class:"grid formInput"},y=(0,a._)("label",{for:"eventTitle"},"活動名稱",-1),k={class:"grid"},P={class:"formInput grid__item--md-span-4"},C=(0,a._)("label",{for:"eventType"},"類型",-1),E=(0,a._)("option",{value:"",selected:"",disabled:""},"請選擇",-1),I=(0,a._)("option",{value:"temp"},"短期",-1),M=(0,a._)("option",{value:"regular"},"常設",-1),F=[E,I,M],T={class:"formInput grid__item--md-span-4"},L=(0,a._)("label",{for:"eventCategory"},"分類",-1),S=(0,a.uE)('<option value="" selected disabled data-v-2f9dca76>請選擇</option><option value="music" data-v-2f9dca76>音樂</option><option value="drama" data-v-2f9dca76>戲劇</option><option value="dance" data-v-2f9dca76>舞蹈</option><option value="design" data-v-2f9dca76>設計</option><option value="art" data-v-2f9dca76>藝術</option><option value="food" data-v-2f9dca76>美食</option><option value="travel" data-v-2f9dca76>旅遊</option><option value="family" data-v-2f9dca76>親子</option><option value="movie" data-v-2f9dca76>電影</option>',10),U=[S],x={class:"formInput grid__item--md-span-4"},H=(0,a._)("label",{for:"eventLocation"},"場地",-1),q=(0,a._)("option",{value:"",selected:"",disabled:""},"請選擇",-1),V=(0,a._)("option",{value:"Aroom"},"圓形劇場",-1),j=(0,a._)("option",{value:"Broom"},"室外舞台",-1),A=[q,V,j],B={class:"grid"},R={class:"formInput grid__item--md-span-4"},Z=(0,a._)("label",{for:"eventPriceFull"},"一般售價",-1),z={class:"formInput grid__item--md-span-4"},O=(0,a._)("label",{for:"eventPriceStudent"},"學生售價",-1),W={class:"formInput grid__item--md-span-4"},K=(0,a._)("label",{for:"eventPriceDiscount"},"優惠售價",-1),N={class:"grid"},Y={class:"formInput grid__item--md-span-6"},G=(0,a._)("label",{for:"eventDateStart"},"開始日期",-1),J={class:"formInput grid__item--md-span-6"},Q=(0,a._)("label",{for:"eventDateEnd"},"結束日期",-1),X={class:"grid formInput"},$=(0,a._)("label",{for:"eventDescription"},"活動內容",-1),ee={class:"grid"},te={class:"formInput grid__item--md-span-6"},ne=(0,a._)("label",{for:"eventPhotos"},[(0,a.Uk)("活動照片"),(0,a._)("span",{style:{color:"red","font-size":"10px"}},"請勿上傳超過1MB")],-1),ae={class:"foremInput grid__item--md-span-6"},le=["src"],oe={class:"grid justify-content-between"},de={class:"grid__item--md-span-6"},ie={key:0,type:"submit",class:"btn fw-bold btn-danger"},ue={class:"grid grid__item--md-span-6 justify-content-md-end"};function ce(e,t,n,l,o,d){const i=(0,a.up)("OnLoad");return(0,a.wg)(),(0,a.iD)("div",{onClick:t[15]||(t[15]=(...e)=>l.checkClick&&l.checkClick(...e)),ref:"productModal",class:"productModal"},[(0,a._)("div",b,[(0,a._)("div",h,[(0,a._)("div",w,[(0,a._)("form",{onSubmit:t[14]||(t[14]=(0,f.iM)(((...e)=>l.submitForm&&l.submitForm(...e)),["prevent"])),class:"productForm"},[(0,a.wy)((0,a.Wm)(i,null,null,512),[[f.F8,l.loading]]),(0,a._)("div",D,[y,(0,a.wy)((0,a._)("input",{type:"text",id:"eventTitle","onUpdate:modelValue":t[0]||(t[0]=e=>l.eventTitle=e),required:""},null,512),[[f.nr,l.eventTitle]])]),(0,a._)("div",k,[(0,a._)("div",P,[C,(0,a.wy)((0,a._)("select",{name:"eventType",id:"eventType","onUpdate:modelValue":t[1]||(t[1]=e=>l.eventType=e),required:""},F,512),[[f.bM,l.eventType]])]),(0,a._)("div",T,[L,(0,a.wy)((0,a._)("select",{name:"eventCategory",id:"eventCategory","onUpdate:modelValue":t[2]||(t[2]=e=>l.eventCategory=e),required:""},U,512),[[f.bM,l.eventCategory]])]),(0,a._)("div",x,[H,(0,a.wy)((0,a._)("select",{name:"eventLocation",id:"eventLocation","onUpdate:modelValue":t[3]||(t[3]=e=>l.eventLocation=e),required:""},A,512),[[f.bM,l.eventLocation]])])]),(0,a._)("div",B,[(0,a._)("div",R,[Z,(0,a.wy)((0,a._)("input",{type:"number",id:"eventPriceFull","onUpdate:modelValue":t[4]||(t[4]=e=>l.eventFullPrice=e),required:""},null,512),[[f.nr,l.eventFullPrice]])]),(0,a._)("div",z,[O,(0,a.wy)((0,a._)("input",{type:"number",id:"eventPriceStudent","onUpdate:modelValue":t[5]||(t[5]=e=>l.eventStudentPrice=e),required:""},null,512),[[f.nr,l.eventStudentPrice]])]),(0,a._)("div",W,[K,(0,a.wy)((0,a._)("input",{type:"number",id:"eventPriceDiscount","onUpdate:modelValue":t[6]||(t[6]=e=>l.eventDiscountPrice=e),required:""},null,512),[[f.nr,l.eventDiscountPrice]])])]),(0,a._)("div",N,[(0,a._)("div",Y,[G,(0,a.wy)((0,a._)("input",{type:"date",id:"eventDateStart","onUpdate:modelValue":t[7]||(t[7]=e=>l.eventStartDate=e),required:""},null,512),[[f.nr,l.eventStartDate]])]),(0,a._)("div",J,[Q,(0,a.wy)((0,a._)("input",{type:"date",id:"eventDateEnd","onUpdate:modelValue":t[8]||(t[8]=e=>l.eventEndDate=e),required:""},null,512),[[f.nr,l.eventEndDate]])])]),(0,a._)("div",X,[$,(0,a.wy)((0,a._)("textarea",{name:"eventDescription",id:"eventDescription","onUpdate:modelValue":t[9]||(t[9]=e=>l.eventDescription=e),cols:"30",rows:"5",required:""},null,512),[[f.nr,l.eventDescription]])]),(0,a._)("div",ee,[(0,a._)("div",te,[ne,(0,a._)("input",{type:"file",id:"eventPhotos",accept:"image/gif,image/jpeg,image/jpg,image/png",onChange:t[10]||(t[10]=(...e)=>l.uploadPhoto&&l.uploadPhoto(...e)),multiple:"multiple"},null,32)]),(0,a._)("div",ae,[(0,a._)("img",{src:l.eventPhotos,class:"preview"},null,8,le)])]),(0,a._)("div",oe,[(0,a._)("div",de,[(0,a._)("button",{type:"button",class:"btn fw-bold btn-cancel",onClick:t[11]||(t[11]=(...e)=>l.closingModal&&l.closingModal(...e))},"取消編輯"),l.productEdit?((0,a.wg)(),(0,a.iD)("button",ie,"儲存修改")):(0,a.kq)("",!0)]),(0,a._)("div",ue,[(0,a._)("button",{type:"submit",class:"btn fw-bold btn-cancel",onClick:t[12]||(t[12]=(...e)=>l.saveDraft&&l.saveDraft(...e))},"設為草稿"),(0,a._)("button",{type:"submit",class:"btn fw-bold btn-danger",onClick:t[13]||(t[13]=(...e)=>l.publishEvent&&l.publishEvent(...e))},"建立活動")])])],32)])])])],512)}(0,a.Cn)();var re=n(4709),ve=n(2262),se=n(5503),pe=(n(9433),n(144),n(8654)),_e={name:"ProductModal",components:{OnLoad:pe.Z},setup(){const e=(0,ve.iH)(null),t=(0,ve.iH)(null),n=(0,ve.iH)(null),l=(0,ve.iH)(null),o=(0,ve.iH)(null),d=(0,ve.iH)(null),i=(0,ve.iH)(null),u=(0,ve.iH)(null),c=(0,ve.iH)(null),r=(0,ve.iH)(null),v=(0,ve.iH)(null),s=(0,ve.iH)(null),p=(0,ve.iH)(null),_=(0,ve.iH)(null),g=(0,ve.iH)(null),m=(0,ve.iH)(null),f=se.Z.firestore();function b(){g.value=!0,m.value=!1}function h(){m.value=!0,g.value=!1}function w(){I.value?F():y()}function D(e){const t=e.target.files.length,n=e.target.files,a=new Image;for(var l=0;l<t;l++){const e=new FileReader;e.readAsDataURL(n[l]),e.onload=function(){a.src=e.result},a.onload=function(){const e=Math.min(1800,a.width),t=a.height*(e/a.width),n=document.createElement("canvas"),l=n.getContext("2d");if(n.width=e,n.height=t,l.drawImage(a,0,0,e,t),n.toDataURL("image/jpeg").length>=1016907)return alert("圖檔過大，請勿上船超過1MB"),void(document.getElementById("eventPhotos").value=null);_.value=n.toDataURL("image/jpeg")}}}async function y(){if(_.value){e.value=!0;const t=f.collection("products").doc();await t.set({eventId:n.value,eventTitle:l.value,eventType:o.value,eventCategory:d.value,eventLocation:i.value,eventFullPrice:u.value,eventStudentPrice:c.value,eventDiscountPrice:r.value,eventStartDate:v.value,eventEndDate:s.value,eventDescription:p.value,eventActive:g.value,eventDraft:m.value});const a=await se.Z.storage().ref("Images/"+n.value+".jpeg");await a.putString(_.value,"data_url").then((e=>{console.log("Uploaded a data_url string!")})),e.value=!1,P(),k.dispatch("getProduct")}else alert("沒有上傳照片喔!")}const k=(0,re.oR)();function P(){k.dispatch("closingModal",!1)}function C(e){"modal-wrapper"===e.target.className&&E()}function E(){k.dispatch("showExitCheck",!0)}const I=(0,ve.Fl)((()=>k.getters.editProduct)),M=(0,ve.Fl)((()=>k.getters.currentProductArray));async function F(){e.value=!0;const a=t.value;await f.collection("products").doc(a).update({eventTitle:l.value,eventType:o.value,eventCategory:d.value,eventLocation:i.value,eventFullPrice:u.value,eventStudentPrice:c.value,eventDiscountPrice:r.value,eventStartDate:v.value,eventEndDate:s.value,eventDescription:p.value,eventActive:g.value,eventDraft:m.value}),se.Z.storage().ref("Images/"+n.value+".jpeg").putString(_.value,"data_url").then((e=>{console.log("Uploaded a data_url string!")}));const b={docId:t.value,eventId:n.value};await k.dispatch("updateProduct",b),e.value=!1,P()}return(0,a.wF)((()=>{if(!I.value){let e=Math.floor(Date.now()/1e3);n.value=e}I.value&&(console.log(M.value.photoUrl),t.value=M.value.docId,n.value=M.value.data.eventId,l.value=M.value.data.eventTitle,o.value=M.value.data.eventType,d.value=M.value.data.eventCategory,i.value=M.value.data.eventLocation,u.value=M.value.data.eventFullPrice,c.value=M.value.data.eventStudentPrice,r.value=M.value.data.eventDiscountPrice,v.value=M.value.data.eventStartDate,s.value=M.value.data.eventEndDate,p.value=M.value.data.eventDescription,_.value=M.value.photoUrl,g.value=M.value.data.eventActive,m.value=M.value.data.eventDraft)})),{loading:e,docId:t,eventId:n,eventTitle:l,eventType:o,eventCategory:d,eventLocation:i,eventFullPrice:u,eventStudentPrice:c,eventDiscountPrice:r,eventStartDate:v,eventEndDate:s,eventDescription:p,eventActive:g,eventDraft:m,eventPhotos:_,uploadPhoto:D,saveDraft:h,publishEvent:b,submitForm:w,closingModal:P,checkClick:C,showingExitCheck:E,eventUpload:y,productEdit:I,eventUpdate:F}}};_e.render=ce,_e.__scopeId="data-v-2f9dca76";var ge=_e;(0,a.dD)("data-v-451689d0");const me={class:"modal-mask"},fe={class:"modal-wrapper"},be={class:"modal-container"},he=(0,a._)("p",null,"確定要退出嗎? 您的變更不會儲存喔!",-1),we={class:"text-center btn-group"};function De(e,t,n,l,o,d){return(0,a.wg)(),(0,a.iD)("div",me,[(0,a._)("div",fe,[(0,a._)("div",be,[he,(0,a._)("div",we,[(0,a._)("button",{type:"button",class:"btn fw-bold btn-danger",onClick:t[0]||(t[0]=(...e)=>l.closeExitCheck&&l.closeExitCheck(...e))},"繼續編輯"),(0,a._)("button",{type:"button",class:"btn fw-bold btn-cancel",onClick:t[1]||(t[1]=(...e)=>l.closingBothModal&&l.closingBothModal(...e))},"放棄編輯")])])])])}(0,a.Cn)();var ye={name:"ExitCheck",setup(){const e=(0,re.oR)();function t(){e.dispatch("closingModal",!1),n()}function n(){e.dispatch("closeExitCheck",!1)}return{closingBothModal:t,closeExitCheck:n}}};ye.render=De,ye.__scopeId="data-v-451689d0";var ke=ye,Pe=n(3577);const Ce={class:"productTable"},Ee={key:0},Ie={key:1};function Me(e,t,n,l,o,d){return(0,a.wg)(),(0,a.iD)("tr",Ce,[(0,a._)("td",null,(0,Pe.zw)(n.product.eventTitle),1),(0,a._)("td",null,(0,Pe.zw)(n.product.eventCategory),1),(0,a._)("td",null,(0,Pe.zw)(n.product.eventStartDate),1),(0,a._)("td",null,(0,Pe.zw)(n.product.eventEndDate),1),(0,a._)("td",null,[n.product.eventActive?((0,a.wg)(),(0,a.iD)("p",Ee,"已啟用")):(0,a.kq)("",!0),n.product.eventDraft?((0,a.wg)(),(0,a.iD)("p",Ie,"尚未啟用")):(0,a.kq)("",!0)]),(0,a._)("td",null,[(0,a._)("button",{class:"btn-danger fw-bold",type:"button",onClick:t[0]||(t[0]=e=>l.deleteEvent(n.product.docId,n.product.eventId))},"刪除"),(0,a._)("button",{class:"btn-cancel fw-bold",type:"button",onClick:t[1]||(t[1]=e=>l.editEvent(n.product.eventId))},"編輯")])])}var Fe={name:"ProductTable",props:["product"],setup(){const e=(0,re.oR)();function t(t){e.dispatch("editProduct",!0),e.dispatch("getCurrentProduct",t)}async function n(t,n){const a=await confirm("確定要刪除嗎? 一去不復返喔!");a&&(e.dispatch("deleteProduct",{docId:t,eventId:n}),e.dispatch("getProduct"))}return{editEvent:t,deleteEvent:n}}};Fe.render=Me;var Te=Fe,Le={name:"products",components:{ProductModal:ge,ExitCheck:ke,ProductTable:Te,OnLoad:pe.Z},setup(){const e=(0,re.oR)(),t=(0,ve.Fl)((()=>e.getters.showExitCheckModal)),n=(0,ve.Fl)((()=>e.getters.showModal));function l(){e.dispatch("showingModal",!0),e.dispatch("editProduct",!1)}(0,a.wF)((()=>{e.dispatch("getProduct")}));const o=(0,ve.Fl)((()=>e.getters.productLoaded)),d=(0,ve.Fl)((()=>e.getters.productData));return{showExitCheckModal:t,showModal:n,showingModal:l,checkProductLoaded:o,productData:d}}};Le.render=m;var Se=Le}}]);
//# sourceMappingURL=763.848dcf35.js.map